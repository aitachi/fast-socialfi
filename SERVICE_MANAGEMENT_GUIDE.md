# ğŸ® æœåŠ¡æ™ºèƒ½ç®¡ç†è„šæœ¬ä½¿ç”¨æŒ‡å—

å¿«é€Ÿå¯åœå’Œç®¡ç† Fast SocialFi çš„æ‰€æœ‰æœåŠ¡,å®ç°æœ€å°èµ„æºå ç”¨å’ŒæŒ‰éœ€å¯åŠ¨ã€‚

---

## ğŸ“‹ è„šæœ¬æ¸…å•

| è„šæœ¬æ–‡ä»¶ | åŠŸèƒ½ | å†…å­˜å ç”¨ |
|---------|------|----------|
| `set-minimal-mode.bat` | è®¾ç½®æœ€å°èµ„æºæ¨¡å¼ | 41 MB |
| `start-elasticsearch.bat` | å¯åŠ¨ Elasticsearch | +1 GB |
| `start-kafka.bat` | å¯åŠ¨ Kafka + Kafka UI | +700 MB |
| `smart-start.bat` | æ™ºèƒ½æ£€æµ‹å¹¶å¯åŠ¨æ‰€éœ€æœåŠ¡ | è‡ªåŠ¨æ£€æµ‹ |
| `check-services.bat` | æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€ | - |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ è®¾ç½®æœ€å°èµ„æºæ¨¡å¼ (æ¨è)

**ä»…è¿è¡Œæ ¸å¿ƒæœåŠ¡,æœ€å°å†…å­˜å ç”¨ 41 MB**

```bash
# åŒå‡»è¿è¡Œæˆ–å‘½ä»¤è¡Œæ‰§è¡Œ
set-minimal-mode.bat
```

**æ•ˆæœ**:
```
âœ… PostgreSQL  - è¿è¡Œä¸­ (37 MB)
âœ… Redis       - è¿è¡Œä¸­ (4.57 MB)
â¸ï¸  Elasticsearch - å·²åœæ­¢
â¸ï¸  Kafka      - å·²åœæ­¢
â¸ï¸  Kafka UI   - å·²åœæ­¢
```

**é€‚ç”¨åœºæ™¯**:
- æ—¥å¸¸å¼€å‘,ä¸ä½¿ç”¨æœç´¢å’Œæ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½
- å†…å­˜èµ„æºæœ‰é™ (â‰¤ 8GB)
- éœ€è¦æœ€å°èµ„æºå ç”¨æ—¶

---

### 2ï¸âƒ£ æŒ‰éœ€å¯åŠ¨ Elasticsearch

**éœ€è¦å…¨æ–‡æœç´¢åŠŸèƒ½æ—¶**

```bash
# åŒå‡»è¿è¡Œ
start-elasticsearch.bat
```

**ç‰¹ç‚¹**:
- âœ… è‡ªåŠ¨æ£€æµ‹æœåŠ¡çŠ¶æ€,é¿å…é‡å¤å¯åŠ¨
- âœ… ç­‰å¾…å¥åº·æ£€æŸ¥å®Œæˆ
- âœ… è‡ªåŠ¨æµ‹è¯•è¿æ¥
- âœ… å¯åŠ¨åè®¿é—®: http://localhost:9200

**ç­‰å¾…æ—¶é—´**: çº¦ 60 ç§’ (Elasticsearch å¯åŠ¨è¾ƒæ…¢)

---

### 3ï¸âƒ£ æŒ‰éœ€å¯åŠ¨ Kafka

**éœ€è¦æ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½æ—¶**

```bash
# åŒå‡»è¿è¡Œ
start-kafka.bat

# æˆ–è‡ªåŠ¨æ‰“å¼€ Kafka UI
start-kafka.bat ui
```

**ç‰¹ç‚¹**:
- âœ… è‡ªåŠ¨å¯åŠ¨ Kafka + Kafka UI
- âœ… æ£€æµ‹å·²è¿è¡Œçš„æœåŠ¡,é¿å…é‡å¤
- âœ… Kafka UI åœ°å€: http://localhost:8090

**ç­‰å¾…æ—¶é—´**: çº¦ 10 ç§’

---

### 4ï¸âƒ£ æ™ºèƒ½è‡ªåŠ¨å¯åŠ¨ (æœ€æ™ºèƒ½)

**è‡ªåŠ¨æ£€æµ‹é¡¹ç›®éœ€è¦çš„æœåŠ¡å¹¶å¯åŠ¨**

```bash
# åœ¨é¡¹ç›®ç›®å½•è¿è¡Œ
smart-start.bat

# æˆ–æŒ‡å®šé¡¹ç›®è·¯å¾„
node smart-start.js /path/to/your/app
```

**å·¥ä½œåŸç†**:
1. æ‰«æé¡¹ç›®ä»£ç  (package.json, src/*.js)
2. æ£€æµ‹æ˜¯å¦ä½¿ç”¨ Elasticsearch (`@elastic/elasticsearch`)
3. æ£€æµ‹æ˜¯å¦ä½¿ç”¨ Kafka (`kafkajs`)
4. è‡ªåŠ¨å¯åŠ¨æ‰€éœ€æœåŠ¡
5. è·³è¿‡å·²è¿è¡Œçš„æœåŠ¡

**ç¤ºä¾‹è¾“å‡º**:
```
æ£€æµ‹åº”ç”¨ç›®å½•: C:\Users\...\fast-socialfi
æ£€æµ‹åˆ°éœ€è¦ä»¥ä¸‹æœåŠ¡:
  PostgreSQL, Redis, Elasticsearch

é¢„è®¡å†…å­˜å ç”¨: 1106 MB

å¼€å§‹å¯åŠ¨æœåŠ¡...
âœ“ PostgreSQL - å·²åœ¨è¿è¡Œ
âœ“ Redis - å·²åœ¨è¿è¡Œ
â³ Elasticsearch - éœ€è¦å¯åŠ¨
âœ“ Elasticsearch å¯åŠ¨æˆåŠŸ

âœ… æ‰€æœ‰æœåŠ¡å·²å°±ç»ª!
```

---

### 5ï¸âƒ£ æŸ¥çœ‹æœåŠ¡çŠ¶æ€

**å¿«é€ŸæŸ¥çœ‹æ‰€æœ‰æœåŠ¡è¿è¡ŒçŠ¶æ€å’Œèµ„æºå ç”¨**

```bash
check-services.bat
```

**è¾“å‡ºç¤ºä¾‹**:
```
========================================
  Fast SocialFi æœåŠ¡çŠ¶æ€
========================================

NAMES                    STATUS                    SIZE
socialfi-postgres        Up 2 hours (healthy)      1.09kB (virtual 239MB)
socialfi-redis           Up 2 hours (healthy)      0B (virtual 39.1MB)
socialfi-elasticsearch   Exited (0) 5 minutes ago

----------------------------------------
  èµ„æºå ç”¨
----------------------------------------

NAME                   CPU %     MEM USAGE / LIMIT   MEM %
socialfi-postgres      0.00%     36.96MiB / 39.69GiB 0.09%
socialfi-redis         0.44%     4.57MiB / 39.69GiB  0.01%
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: æ—¥å¸¸å¼€å‘ (æ¨è)

**æ­¥éª¤**:
```bash
1. set-minimal-mode.bat        # è®¾ç½®æœ€å°æ¨¡å¼
2. å¼€å‘åº”ç”¨...                  # PostgreSQL + Redis å¯ç”¨
3. (éœ€è¦æœç´¢æ—¶) start-elasticsearch.bat
4. (éœ€è¦æ¶ˆæ¯é˜Ÿåˆ—æ—¶) start-kafka.bat
```

**ä¼˜ç‚¹**:
- âœ… æœ€å°èµ„æºå ç”¨ (41 MB)
- âœ… æ ¸å¿ƒåŠŸèƒ½å¯ç”¨
- âœ… æŒ‰éœ€å¯åŠ¨å…¶ä»–æœåŠ¡

---

### åœºæ™¯ 2: å®Œæ•´åŠŸèƒ½æµ‹è¯•

**æ­¥éª¤**:
```bash
docker-compose -f docker-compose.full.yml up -d
```

**ä¼˜ç‚¹**:
- âœ… æ‰€æœ‰æœåŠ¡å¯ç”¨
- âœ… æ— éœ€æ‰‹åŠ¨å¯åŠ¨

**ç¼ºç‚¹**:
- âš ï¸ å†…å­˜å ç”¨ 3.7 GB

---

### åœºæ™¯ 3: è‡ªåŠ¨åŒ–å¼€å‘ (æ™ºèƒ½)

**æ­¥éª¤**:
```bash
1. smart-start.bat              # è‡ªåŠ¨æ£€æµ‹å¹¶å¯åŠ¨
2. å¼€å‘åº”ç”¨...
3. (ä¿®æ”¹ä»£ç å) smart-start.bat  # è‡ªåŠ¨å¯åŠ¨æ–°éœ€è¦çš„æœåŠ¡
```

**ä¼˜ç‚¹**:
- âœ… è‡ªåŠ¨åŒ–
- âœ… æŒ‰éœ€å¯åŠ¨
- âœ… é¿å…èµ„æºæµªè´¹

---

## ğŸ”§ é«˜çº§ç”¨æ³•

### åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹æœåŠ¡

åœ¨ä½ çš„åº”ç”¨å¯åŠ¨è„šæœ¬ä¸­é›†æˆ:

**package.json**:
```json
{
  "scripts": {
    "prestart": "node smart-start.js",
    "start": "node src/index.js"
  }
}
```

**æ•ˆæœ**:
- è¿è¡Œ `npm start` æ—¶è‡ªåŠ¨æ£€æµ‹å¹¶å¯åŠ¨æ‰€éœ€æœåŠ¡
- æ— éœ€æ‰‹åŠ¨ç®¡ç†æœåŠ¡

---

### è‡ªå®šä¹‰æœåŠ¡æ£€æµ‹

ä¿®æ”¹ `smart-start.js` ä¸­çš„æ£€æµ‹é€»è¾‘:

```javascript
// æ·»åŠ è‡ªå®šä¹‰æ£€æµ‹è§„åˆ™
const customPatterns = {
  elasticsearch: ['@elastic', 'searchEngine', 'fullTextSearch'],
  kafka: ['kafkajs', 'messageQueue', 'eventBus']
};
```

---

## ğŸ“Š èµ„æºå¯¹æ¯”

| æ¨¡å¼ | æœåŠ¡ | å†…å­˜å ç”¨ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|----------|
| **æœ€å°æ¨¡å¼** | PostgreSQL + Redis | 41 MB | æ—¥å¸¸å¼€å‘ |
| **+ Elasticsearch** | +ES | 1.1 GB | éœ€è¦æœç´¢ |
| **+ Kafka** | +Kafka | 741 MB | éœ€è¦æ¶ˆæ¯é˜Ÿåˆ— |
| **å®Œæ•´æ¨¡å¼** | æ‰€æœ‰æœåŠ¡ | 3.73 GB | å®Œæ•´æµ‹è¯• |

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: è„šæœ¬è¿è¡Œå¤±è´¥

**å¯èƒ½åŸå› **: Docker æœªè¿è¡Œ

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å¯åŠ¨ Docker Desktop
# ç„¶åé‡æ–°è¿è¡Œè„šæœ¬
```

---

### é—®é¢˜ 2: æœåŠ¡å¯åŠ¨è¶…æ—¶

**å¯èƒ½åŸå› **: ç³»ç»Ÿèµ„æºä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æŸ¥çœ‹ Docker æ—¥å¿—
docker logs socialfi-elasticsearch

# 2. å¢åŠ  Docker å†…å­˜é™åˆ¶ (Docker Desktop è®¾ç½®)

# 3. åœæ­¢å…¶ä»–ä¸å¿…è¦çš„å®¹å™¨
docker stop $(docker ps -q --filter "name=socialfi-")
```

---

### é—®é¢˜ 3: æœåŠ¡å·²å¯åŠ¨ä½†æ— æ³•è¿æ¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
docker ps --filter "name=socialfi-" --format "table {{.Names}}\t{{.Status}}"

# æŸ¥çœ‹æ—¥å¿—
docker logs -f socialfi-postgres
docker logs -f socialfi-redis
docker logs -f socialfi-elasticsearch

# é‡å¯æœåŠ¡
docker restart socialfi-postgres
```

---

## ğŸ“ è„šæœ¬å·¥ä½œæµç¨‹

### `set-minimal-mode.bat` æµç¨‹

```
1. æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œ
   â†“
2. åœæ­¢ Elasticsearch
   â†“
3. åœæ­¢ Kafka
   â†“
4. åœæ­¢ Kafka UI
   â†“
5. ç¡®ä¿ PostgreSQL è¿è¡Œ
   â†“
6. ç¡®ä¿ Redis è¿è¡Œ
   â†“
7. æ˜¾ç¤ºçŠ¶æ€å’Œèµ„æºå ç”¨
```

---

### `smart-start.bat` æµç¨‹

```
1. æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œ
   â†“
2. æ£€æµ‹åº”ç”¨ç›®å½•
   â†“
3. æ‰«æä»£ç æ–‡ä»¶ (package.json, src/*.js)
   â†“
4. æ£€æµ‹ä¾èµ–:
   - @elastic/elasticsearch â†’ éœ€è¦ ES
   - kafkajs â†’ éœ€è¦ Kafka
   â†“
5. æ£€æŸ¥æœåŠ¡æ˜¯å¦å·²è¿è¡Œ
   â†“
6. å¯åŠ¨ç¼ºå¤±çš„æœåŠ¡
   â†“
7. æ˜¾ç¤ºæ€»ç»“
```

---

## ğŸ¨ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹é»˜è®¤å¯åŠ¨è¡Œä¸º

ç¼–è¾‘ `smart-start.js`:

```javascript
// ä¿®æ”¹æ ¸å¿ƒæœåŠ¡ (å§‹ç»ˆå¯åŠ¨)
const CORE_SERVICES = ['postgres', 'redis'];

// ä¿®æ”¹å†…å­˜é˜ˆå€¼
const MEMORY_LIMIT_MB = 4096; // è¶…è¿‡æ­¤å€¼æ—¶è­¦å‘Š

// ä¿®æ”¹æœåŠ¡ä¼˜å…ˆçº§
const SERVICE_PRIORITY = {
  postgres: 1,
  redis: 2,
  elasticsearch: 3,
  kafka: 4
};
```

---

## ğŸ“– ç¤ºä¾‹å·¥ä½œæµ

### å‰ç«¯å¼€å‘è€… (ä¸éœ€è¦åç«¯æœåŠ¡)

```bash
# åªå¯åŠ¨æœ€å°æœåŠ¡
set-minimal-mode.bat

# å¼€å‘å‰ç«¯...
# PostgreSQL å’Œ Redis å¾…å‘½
```

---

### å…¨æ ˆå¼€å‘è€… (éœ€è¦æœç´¢åŠŸèƒ½)

```bash
# è®¾ç½®æœ€å°æ¨¡å¼
set-minimal-mode.bat

# å¼€å‘åˆ°éœ€è¦æœç´¢æ—¶
start-elasticsearch.bat

# ç»§ç»­å¼€å‘...
```

---

### åç«¯å¼€å‘è€… (éœ€è¦æ¶ˆæ¯é˜Ÿåˆ—)

```bash
# ä½¿ç”¨æ™ºèƒ½å¯åŠ¨
smart-start.bat

# ä»£ç ä¸­æœ‰ kafkajs ä¾èµ–
# è‡ªåŠ¨å¯åŠ¨ PostgreSQL, Redis, Kafka
```

---

## âš¡ æ€§èƒ½æç¤º

### æé«˜å¯åŠ¨é€Ÿåº¦

1. **ä½¿ç”¨ SSD**: Docker æ•°æ®å­˜å‚¨åœ¨ SSD ä¸Š
2. **åˆ†é…è¶³å¤Ÿå†…å­˜**: Docker Desktop è®¾ç½®ä¸­å¢åŠ å†…å­˜
3. **é¢„æ‹‰å–é•œåƒ**:
   ```bash
   docker-compose -f docker-compose.full.yml pull
   ```

### å‡å°‘èµ„æºå ç”¨

1. **å®šæœŸæ¸…ç†**:
   ```bash
   docker system prune -a --volumes
   ```

2. **é™åˆ¶æ—¥å¿—å¤§å°**:
   ```yaml
   # docker-compose.yml
   logging:
     options:
       max-size: "10m"
       max-file: "3"
   ```

---

## ğŸ¯ æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **å¼€å‘æ—¶ä½¿ç”¨æœ€å°æ¨¡å¼**: èŠ‚çœèµ„æº,æé«˜æ•ˆç‡
2. **ä½¿ç”¨æ™ºèƒ½å¯åŠ¨**: è‡ªåŠ¨åŒ–,å‡å°‘æ‰‹åŠ¨æ“ä½œ
3. **æŒ‰éœ€å¯åŠ¨æœåŠ¡**: åªå¯åŠ¨å½“å‰éœ€è¦çš„æœåŠ¡
4. **å®šæœŸæ£€æŸ¥çŠ¶æ€**: è¿è¡Œ `check-services.bat`

### âŒ é¿å…åšæ³•

1. **ä¸è¦ä¸€ç›´è¿è¡Œæ‰€æœ‰æœåŠ¡**: æµªè´¹èµ„æº
2. **ä¸è¦é¢‘ç¹é‡å¯æœåŠ¡**: å½±å“æ•ˆç‡
3. **ä¸è¦å¿½ç•¥é”™è¯¯æ—¥å¿—**: åŠæ—¶æ’æŸ¥é—®é¢˜

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜?

1. æŸ¥çœ‹æ—¥å¿—: `docker logs -f socialfi-<service>`
2. æ£€æŸ¥çŠ¶æ€: `check-services.bat`
3. é‡ç½®æœåŠ¡: `docker-compose -f docker-compose.full.yml down && docker-compose -f docker-compose.full.yml up -d`

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-11-02
**é€‚ç”¨ç³»ç»Ÿ**: Windows (Linux/Mac éœ€ä¿®æ”¹è„šæœ¬æ‰©å±•åä¸º .sh)
